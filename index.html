<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Together ‚Äì Solid Mobile Scroll (Dual Rain, No H-Scroll)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --lavender: #C98AF7;
      --deep-purple: rgba(155, 75, 222, 0.3);
      --fall-distance: 100vh; /* fallback */
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;width:100%; overflow-x:hidden;}
    body{
      background:#111;
      display:block;
      font-family:"Poppins", sans-serif;
      min-height:100vh;
      overflow-y:auto;
      padding:max(16px, env(safe-area-inset-top)) max(16px, env(safe-area-inset-right)) max(16px, env(safe-area-inset-bottom)) max(16px, env(safe-area-inset-left));
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    .fit{
      position:relative;
      width:100%;
      max-width:1242px;
      /* Gi·ªØ nguy√™n chi·ªÅu r·ªông, chi·ªÅu cao d√†i h∆°n (b·∫£n hi·ªán t·∫°i c·ªßa b·∫°n d√πng ~8000px) */
      aspect-ratio:1242/9500;
      background:var(--lavender);
      overflow-y:auto; /* ch·ªâ cu·ªôn d·ªçc */
      overflow-x:hidden; /* kh√¥ng cu·ªôn ngang */
      border-radius:20px;
      margin:0 auto;
      touch-action:pan-y; /* tr√°nh pan-x v√¥ t√¨nh */
      overscroll-behavior:contain;
      -webkit-overflow-scrolling:touch;
      contain:layout paint size; /* c√¥ l·∫≠p ƒë·ªÉ tr√°nh reflow lan r·ªông tr√™n mobile */
    }

    /* N·ª≠a tr√™n: gi·ªØ ƒë√∫ng b·ªë c·ª•c ban ƒë·∫ßu */
    .original{position:relative; width:100%; aspect-ratio:1242/2688; background:transparent; overflow:hidden; z-index:2}
    .phone{position:absolute; inset:0; background:var(--lavender); overflow:hidden}

    /* RAIN: chuy·ªÉn t·ª´ fixed (100vh/100vw) sang absolute theo t·ª´ng container ƒë·ªÉ tr√°nh glitch khi cu·ªôn nhanh */
    .rain{position:absolute; inset:0; width:100%; height:100%; pointer-events:none; z-index:2}
    .drop{position:absolute; top:-60px; user-select:none; will-change:transform, opacity;}
    .drop.heart{color:#9B4BDE}
    .drop.cat{filter:saturate(1.1)}
    @keyframes fallFade{ 0%{transform:translateY(-60px) rotate(0deg); opacity:1} 70%{opacity:0.35} 100%{transform:translateY(calc(var(--fall-distance, 100vh) + 60px)) rotate(25deg); opacity:0} }

    .title{position:absolute; left:6%; top:3%; color:#fff; font-weight:600; font-size:clamp(32px, 7vw, 90px); letter-spacing:1px; z-index:5}
    @media (max-width:600px){.title{top:2%}}
    .main-card{position:absolute; left:10%; right:10%; top:12%; height:35%; background:var(--deep-purple); border-radius:8vw; color:#fff; display:grid; place-items:center; z-index:3; padding:10px}
    .main-card .stack{text-align:center; line-height:2.12}
    .main-card .stack div{font-size:clamp(20px, 6vw, 72px); font-weight:600}
    .label{font-size:clamp(12px, 3vw, 42px); font-weight:400; margin-left:1vw}
    .img-box{position:absolute; left:12%; right:12%; bottom:6%; aspect-ratio:1/1; border-radius:3vw; overflow:hidden; background:#fff; box-shadow:0 2vw 5vw rgba(0,0,0,.25); z-index:4; display:flex; align-items:center; justify-content:center; transform:scale(0.75)}
    .img-stack{position:relative; width:100%; height:100%}
    .img-stack img{position:absolute; width:100%; height:100%; object-fit:cover; border-radius:2vw; transition:all .6s ease; image-rendering:-webkit-optimize-contrast; image-rendering:crisp-edges}
    #imgStack img{opacity:.8 !important}
    .img-stack img:nth-child(1){z-index:5; top:0; left:0}
    .img-stack img:nth-child(2){z-index:4; top:-1.2vw; left:-1.2vw}
    .img-stack img:nth-child(3){z-index:3; top:-2.4vw; left:-2.4vw}
    .img-stack img:nth-child(4){z-index:2; top:-3.6vw; left:-3.6vw}
    .img-stack img:nth-child(5){z-index:1; top:-4.8vw; left:-4.8vw}
    .img-box.secondary{left:50%; top:70%; transform:translateX(-50%) scale(1.35)}

    /* N·ª≠a d∆∞·ªõi: message ·ªü TR√äN l·ªõp m∆∞a th·ª© 2 */
    .extra{position:relative; width:100%; padding:24px 20px 40px; display:flex; align-items:flex-start; justify-content:center; background:linear-gradient(180deg, rgba(0,0,0,.06), rgba(0,0,0,.12)); z-index:10}
    .extra .rain{z-index:9}
    .message-box{position:relative; z-index:11; width:min(92%, 1000px); background: rgba(201, 138, 247, 0.9); color:#fff; border-radius:16px; box-shadow:0 12px 28px rgba(0,0,0,.24); padding:16px 18px}
    .message-box h3{font-size:18px; margin-bottom:8px; color:#fff}
    .message-box p{font-size:14px; line-height:1.65; color:#fff}
  </style>
</head>
<body>
  <div class="fit" id="fit">
    <!-- L·ªõp m∆∞a cho n·ª≠a tr√™n -->
    <section class="original" id="original">
      <main class="phone">
        <div class="rain" id="rainTop"></div>
        <h1 class="title">TOGETHER</h1>
        <section class="main-card">
          <div class="stack">
            <div><span id="yearVal">0</span><span class="label">years</span></div>
            <div><span id="dayVal">0</span><span class="label">days</span></div>
            <div><span id="secondVal">0</span><span class="label">seconds</span></div>
          </div>
        </section>
        <div class="img-box">
          <div class="img-stack" id="imgStack"></div>
        </div>
        <div class="img-box secondary">
          <div class="img-stack" id="imgStackSecondary"></div>
        </div>
      </main>
    </section>

    <!-- N·ª≠a d∆∞·ªõi: l·ªõp m∆∞a ri√™ng + message-box n·∫±m TR√äN -->
    <section class="extra" id="extra">
      <div class="rain" id="rainExtra"></div>
      <div class="message-box">
        <h3>üíú</h3>
        <p id="extraText">C·∫£ 1 qu√° tr√¨nh, 1 ch·∫∑ng ƒë∆∞·ªùng, t·ª´ c√°i l√∫c c√≤n ch∆∞a bi·∫øt m·∫∑t nhau, ch·ªâ t√¨nh c·ªù ƒë√πa v·ªõi nhau v√†i c√¢u, r·ªìi nh·∫Øn tin v·ªõi nhau m√† r·ªìi th√≠ch nhau, y√™u nhau, r·ªìi c√£i v√£, r·ªìi l·∫°i th∆∞∆°ng, r·ªìi kh√¥ng hi·ªÉu nhau, l·∫°i c√£i nhau, r·ªìi l·∫°i hi·ªÉu nhau h∆°n, c√πng nhau t·ª´ nh·ªØng ng√†y ƒë·∫ßu ƒë·∫∑t ch√¢n ƒë·∫øn tr∆∞·ªùng, c√πng nhau t·ªët nghi·ªáp, c√πng ƒëi g·∫ßn ƒëi xa, tr·∫£i qua kh√¥ng bi·∫øt bao nhi√™u chuy·ªán l·ªõn nh·ªè, m·ª•c ƒë√≠ch cu·ªëi c√πng v·∫´n l√† ƒë·ªÉ ·ªü b√™n nhau, nghƒ© v·ªÅ t∆∞∆°ng lai. V·∫≠y m√† ch·ªâ v√¨ kho·∫£ng th·ªùi gian n√†y nguy√™n nh√¢n ch√≠nh l√† kh√¥ng c√≥ th·ªùi gian b√™n nhau m√† l·∫°i xa nhau, kh√¥ng l·ªói l·∫ßm qu√° ƒë√°ng kh√¥ng th·ªÉ tha th·ª©, kh√¥ng c√≥ nguy√™n nh√¢n ƒë·ªß n·∫∑ng, kh√¥ng ng∆∞·ªùi th·ª© 3, v·∫≠y m√† l·∫°i d·ªÖ d√†ng t·ª´ b·ªè!

<br><br>Anh bi·∫øt m√¨nh ƒë√£ qua c√°i kho·∫£ng th·ªùi gian m√† c·∫ßn nhau, nh·ªõ nhau nhi·ªÅu t·ªõi m·ª©c ch·ªâ mu·ªën ·ªü c·∫°nh, m·ªói giai ƒëo·∫°n m·ªói th·ªùi ƒëi·ªÉm m·ªçi th·ª© c≈©ng s·∫Ω thay ƒë·ªïi theo. B√¢y gi·ªù c≈©ng v·∫≠y, kh√¥ng c·∫ßn ph·∫£i l√∫c n√†o c≈©ng ph·∫£i k√® b√™n nhau, em c·∫ßn c√≥ kh√¥ng gian ri√™ng, anh c≈©ng v·∫≠y. Nh∆∞ng ch·ªâ c·∫ßn nh·ªØng l√∫c nh∆∞ c√≥ vi·ªác ƒëi xa th√¨ c√≥ ng∆∞·ªùi ƒë·ªìng h√†nh, l√∫c c√≥ l√†m sao c√≥ ƒëi b·ªánh vi·ªán th√¨ c√≥ ng∆∞·ªùi ƒëi c√πng, c√≥ 1 ng∆∞·ªùi ƒë·ªÉ tr√≤ chuy·ªán, ƒë·ªÉ t√¢m s·ª±. Anh nh·∫≠n ra ƒë√≥ m·ªõi l√† c√°i hi·ªán t·∫°i anh v√† em c·∫ßn, tr∆∞·ªõc gi·ªù anh hong c√≥ suy nghƒ© v·∫≠y, h√¥m nay anh m·ªõi ng·∫´m l·∫°i th√¨ anh c·∫£m th·∫•y tr∆∞·ªõc gi·ªù 2 ƒë·ª©a m√¨nh ·ªü b√™n c·∫°nh nhau ch·ªâ nghƒ© c·∫ßn nhau, c√≥ t√¨nh c·∫£m l√† ƒë·ªß, nh∆∞ng m√† th·ªùi ƒëi·ªÉm n√†y, th·ªùi gian b√™n nhau kh√¥ng c√≥, th√¨ anh nghƒ© quan t√¢m nhau m·ªõi l√† c√°i quan tr·ªçng nh·∫•t. Kh√¥ng ph·∫£i l√† tr∆∞·ªõc gi·ªù anh kh√¥ng quan t√¢m em, ch·ªâ l√† ch∆∞a ƒë·ªß, anh kh√¥ng n√≥i ra nh∆∞ng l√∫c n√†o anh c≈©ng nghƒ© em c·∫ßn g√¨, em th√≠ch g√¨ ƒë·ªÉ anh mua cho em vui, nh∆∞ng anh kh√¥ng nh·∫≠n ra em c·∫ßn s·ª± chia s·∫ª, s·ª± k·∫øt n·ªëi h∆°n l√† ƒëi·ªÅu ƒë√≥. Em c≈©ng quan t√¢m anh nh∆∞ng c√†ng ng√†y c√†ng √≠t ƒëi v√¨ em kh√¥ng c√≥ th·ªùi gian nghƒ© t·ªõi n·ªØa, anh hi·ªÉu!! Hay l√† em c·ª© ch·∫•p nh·∫≠n, c·ª© ƒë·ªÉ anh thay ƒë·ªïi c√°ch m√¨nh quen nhau, thay ƒë·ªïi lu√¥n c·∫£ c√°ch nh√¨n nh·∫≠n, ƒë·ªëi x·ª≠ v·ªõi nhau nh·∫π nh√†ng h∆°n.

<br><br>M·∫•y h√¥m nay anh suy nghƒ© nhi·ªÅu l·∫Øm, v·ªÅ t·ª´ng chuy·ªán l·ªõn nh·ªè x∆∞a gi·ªù, anh nghƒ© m√¨nh c≈©ng ƒë√£ th·ª±c s·ª± hi·ªÉu, c≈©ng t·ªõi l√∫c anh ph·∫£i tr∆∞·ªüng th√†nh r·ªìi. Nh∆∞ng anh v·∫´n mu·ªën c√≥ em ·ªü c·∫°nh, v·∫´n mu·ªën em l√† ∆∞u ti√™n c·ªßa anh, anh c≈©ng kh√¥ng c·∫ßn em ph·∫£i thay ƒë·ªïi g√¨ ƒë√¢u, ch·ªâ l√† anh mu·ªën anh s·∫Ω thay ƒë·ªïi c√°ch anh ƒë·ªëi x·ª≠ v·ªõi em th√¥i. 7 nƒÉm qua em quen, em y√™u 1 ƒë·ª©a con n√≠t, b√¢y gi·ªù anh bi·∫øt ƒë√£ ƒë·∫øn l√∫c em c·∫ßn 1 ng∆∞·ªùi tr∆∞·ªüng th√†nh h∆°n.

<br><br>Th·ª≠ c√πng nhau c·ªë g·∫Øng 1 l·∫ßn, thay ƒë·ªïi c√°ch suy nghƒ© 1 l·∫ßn, c√πng h∆∞·ªõng t·ªõi t∆∞∆°ng lai t·ªët ƒë·∫πp h∆°n. B·ªè h·∫øt nh·ªØng chuy·ªán kh√¥ng vui, l√†m ng∆∞·ªùi y√™u anh 1 l·∫ßn n·ªØa, nha üíú</p>
      </div>
    </section>
  </div>

  <!-- Self-test results (·∫©n) -->
  <details style="position:absolute; left:-9999px; top:-9999px;">
    <summary>Self tests</summary>
    <pre id="test-output"></pre>
  </details>

  <script>
  (() => {
    'use strict';

    // Tr√°nh kh·ªüi t·∫°o l·∫∑p l·∫°i n·∫øu canvas t·ª± reload
    if (window.__WE_HAVE_INIT__) {
      console.info('[WeHave] already initialized ‚Äì skip re-init');
      return;
    }
    window.__WE_HAVE_INIT__ = true;

    // --- Time counters ---
    const START = new Date(2018, 7, 13); // 13/08/2018
    const yearVal = document.getElementById('yearVal');
    const dayVal = document.getElementById('dayVal');
    const secondVal = document.getElementById('secondVal');

    function fullDaysSince(s, n){
      const startD = new Date(s.getFullYear(), s.getMonth(), s.getDate());
      const nowD = new Date(n.getFullYear(), n.getMonth(), n.getDate());
      return Math.floor((nowD - startD) / 86400000);
    }
    function fullSecondsSince(s, n){ return Math.floor((n - s) / 1000); }
    function fullYearsSince(s, n){
      let y = n.getFullYear() - s.getFullYear();
      if (n.getMonth() < s.getMonth() || (n.getMonth() === s.getMonth() && n.getDate() < s.getDate())) y--;
      return y;
    }
    function updateCounters(){
      const now = new Date();
      yearVal.textContent = fullYearsSince(START, now);
      dayVal.textContent = fullDaysSince(START, now);
      secondVal.textContent = fullSecondsSince(START, now);
    }
    updateCounters();
    const counterTimer = setInterval(updateCounters, 1000);

    // --- Rain effect (mobile-safe) ---
    const fit = document.getElementById('fit');
    const original = document.getElementById('original');
    const extra = document.getElementById('extra');
    const rainTop = document.getElementById('rainTop');
    const rainExtra = document.getElementById('rainExtra');

    // C·∫≠p nh·∫≠t qu√£ng r∆°i theo chi·ªÅu cao th·ª±c c·ªßa t·ª´ng container
    function setFallDistanceFor(el, container){
      if (!el || !container) return;
      const h = container.offsetHeight || fit.offsetHeight || window.innerHeight;
      el.style.setProperty('--fall-distance', h + 'px');
      el.style.transform = 'translateZ(0)'; // nudge compositing on iOS
    }
    function setAllFallDistances(){
      setFallDistanceFor(rainTop, original);
      setFallDistanceFor(rainExtra, extra);
    }
    setAllFallDistances();

    // Resize & orientation change
    window.addEventListener('resize', setAllFallDistances, { passive:true });

    // Debounce b·∫±ng rAF khi cu·ªôn nhanh, v√† gi·∫£m spawn t·∫°m th·ªùi ƒë·ªÉ tr√°nh jank
    let rafId = null, speedFactor = 1, lastY = 0, lastT = performance.now();
    fit.addEventListener('scroll', () => {
      const now = performance.now();
      const y = fit.scrollTop; const dy = Math.abs(y - lastY); const dt = Math.max(16, now - lastT);
      const v = dy / dt; // px/ms
      speedFactor = v > 1.2 ? 0.3 : v > 0.6 ? 0.6 : 1; // gi·∫£m t·∫°m spawn khi k√©o r·∫•t nhanh
      lastY = y; lastT = now;
      if (rafId) return;
      rafId = requestAnimationFrame(() => { setAllFallDistances(); rafId = null; });
    }, { passive:true });

    const rand = (min, max) => Math.random() * (max - min) + min;

    // Gi·ªõi h·∫°n ph·∫ßn t·ª≠ ƒë·ªÉ tr√°nh r√≤ r·ªâ b·ªô nh·ªõ l√∫c cu·ªôn l√¢u
    const MAX_DROPS_PER_LAYER = 160;
    function trimDrops(layer){
      if (!layer) return;
      while (layer.childElementCount > MAX_DROPS_PER_LAYER) {
        layer.removeChild(layer.firstElementChild);
      }
    }

    function spawnDrop(layer){
      if (!layer) return;
      const isCat = Math.random() < 0.35;
      const span = document.createElement('span');
      span.className = `drop ${isCat ? 'cat' : 'heart'}`;
      span.textContent = isCat ? 'üò∫' : 'üíú';
      span.style.fontSize = (isCat ? rand(28, 44) : rand(18, 32)) + 'px';
      span.style.left = rand(0, 100) + '%';
      span.style.animation = `fallFade ${rand(5, 10)}s linear`;
      span.style.animationFillMode = 'forwards';
      layer.appendChild(span);
      span.addEventListener('animationend', () => span.remove(), { once:true });
      trimDrops(layer);
    }

    let rainTimer = null;
    function startRain(){
      if (rainTimer) return;
      rainTimer = setInterval(() => {
        const nTop = Math.floor(rand(1, 4) * speedFactor);
        const nExtra = Math.floor(rand(1, 4) * speedFactor);
        for (let i = 0; i < nTop; i++) spawnDrop(rainTop);
        for (let i = 0; i < nExtra; i++) spawnDrop(rainExtra);
      }, 300);
    }
    function stopRain(){ if (rainTimer) { clearInterval(rainTimer); rainTimer = null; } }

    document.addEventListener('visibilitychange', () => { if (document.hidden) stopRain(); else startRain(); });
    startRain();

    // --- Image stacks (gi·ªØ nguy√™n) ---
    const LINKS = [
      'https://i.postimg.cc/kVHYddxK/Image-Aug-09-2025.png',
      'https://i.postimg.cc/FfYGpn2R/IMG-Aug-09-2025.jpg',
      'https://i.postimg.cc/PC32mkV9/IMG-Aug-09-2025-1.jpg',
      'https://i.postimg.cc/Vry9RsqG/IMG-20250809-214449.jpg',
      'https://i.postimg.cc/vxbWJPS5/IMG-20250809-214413.jpg'
    ];

    const stackEl = document.getElementById('imgStack');
    const stackElSecondary = document.getElementById('imgStackSecondary');
    const rotatedLinks = LINKS.slice(1).concat(LINKS[0]);

    rotatedLinks.forEach(src => {
      const img = document.createElement('img');
      img.src = src; img.referrerPolicy = 'no-referrer'; img.crossOrigin = 'anonymous';
      stackEl.appendChild(img.cloneNode());
    });

    LINKS.forEach(src => {
      const img = document.createElement('img');
      img.src = src; img.referrerPolicy = 'no-referrer'; img.crossOrigin = 'anonymous';
      stackElSecondary.appendChild(img);
    });

    const rotateTimer = setInterval(() => {
      const imgs = [...stackEl.children]; if (imgs.length) stackEl.appendChild(imgs.shift());
      const imgs2 = [...stackElSecondary.children]; if (imgs2.length) stackElSecondary.appendChild(imgs2.shift());
    }, 2000);

    // --- Self-tests: gi·ªØ test c≈© + b·ªï sung test ch·ªëng cu·ªôn ngang & qu√£ng r∆°i ---
    (function runSelfTests(){
      const out = [];
      const log = (ok, name, got, exp) => {
        const icon = ok ? '‚úÖ' : '‚ùå';
        const line = `${icon} ${name} | got: ${got} | expected: ${exp}`;
        (ok ? console.log : console.error)(line);
        out.push(line);
      };
      const s = new Date(2018, 7, 13);
      // Gi·ªØ nguy√™n test c≈©
      const _fullDays = (s, n) => { const sd = new Date(s.getFullYear(), s.getMonth(), s.getDate()); const nd = new Date(n.getFullYear(), n.getMonth(), n.getDate()); return Math.floor((nd - sd) / 86400000);} 
      const _fullYears = (s, n) => { let y = n.getFullYear() - s.getFullYear(); if (n.getMonth() < s.getMonth() || (n.getMonth() === s.getMonth() && n.getDate() < s.getDate())) y--; return y; }
      const _fullSecs = (s, n) => Math.floor((n - s) / 1000);
      log(_fullDays(s, new Date(2018, 7, 14)) === 1, 'fullDaysSince +1 day', _fullDays(s, new Date(2018,7,14)), 1);
      log(_fullYears(s, new Date(2019, 7, 12)) === 0, 'fullYearsSince before anniversary', _fullYears(s, new Date(2019,7,12)), 0);
      log(_fullYears(s, new Date(2019, 7, 13)) === 1, 'fullYearsSince on anniversary', _fullYears(s, new Date(2019,7,13)), 1);
      log(_fullSecs(s, new Date(s.getTime() + 61000)) === 61, 'fullSecondsSince +61s', _fullSecs(s, new Date(s.getTime()+61000)), 61);

      // B·ªï sung: kh√¥ng cu·ªôn ngang (page & .fit)
      const sw = document.documentElement.scrollWidth, cw = document.documentElement.clientWidth;
      log(sw <= cw + 1, 'No horizontal scroll (page)', `${sw}px`, `<= ${cw+1}px`);
      const fitEl = document.getElementById('fit');
      log(fitEl.scrollWidth <= fitEl.clientWidth + 1, 'No horizontal scroll (.fit)', `${fitEl.scrollWidth}px`, `<= ${fitEl.clientWidth+1}px`);

      // B·ªï sung: bi·∫øn qu√£ng r∆°i ƒë√£ ƒë∆∞·ª£c set > 0 cho c·∫£ 2 l·ªõp m∆∞a
      const dTop = parseInt(getComputedStyle(rainTop).getPropertyValue('--fall-distance')) || 0;
      const dExtra = parseInt(getComputedStyle(rainExtra).getPropertyValue('--fall-distance')) || 0;
      log(dTop > 0, 'fall-distance top > 0', dTop, '>0');
      log(dExtra > 0, 'fall-distance extra > 0', dExtra, '>0');

      const pre = document.getElementById('test-output'); if (pre) pre.textContent = out.join('\n');
      document.documentElement.setAttribute('data-tests', out.some(l => l.startsWith('‚ùå')) ? 'failed' : 'passed');
    })();

    // Optional teardown hook
    window.__WE_HAVE_APP__ = {
      teardown(){
        clearInterval(counterTimer);
        stopRain();
        clearInterval(rotateTimer);
        window.removeEventListener('resize', setAllFallDistances);
        fit.removeEventListener('scroll', setAllFallDistances);
      }
    };
  })();
  </script>

  <!-- ========================= -->
  <!-- PASSCODE OVERLAY (1308)  -->
  <!-- ========================= -->
  <script>
  (function(){
    'use strict';
    if (window.__PIN_OVERLAY_INIT__) return; // tr√°nh kh·ªüi t·∫°o 2 l·∫ßn khi Canvas reload
    window.__PIN_OVERLAY_INIT__ = true;

    // C·∫•u h√¨nh ‚Äî ƒë·ªÉ tr√°nh b·ªã h·ªèi l·∫°i khi Canvas auto-reload, m·∫∑c ƒë·ªãnh ch·ªâ h·ªèi M·ªñI PHI√äN.
    // ƒê·ªïi ALWAYS_ASK th√†nh true n·∫øu b·∫°n mu·ªën l√∫c n√†o m·ªü trang c≈©ng ph·∫£i nh·∫≠p m√£.
    const ALWAYS_ASK = false;
    const PASS_KEY = 'pass_ok_1308';
    const CORRECT = '1308';

    try {
      if (!ALWAYS_ASK && sessionStorage.getItem(PASS_KEY) === '1') return; // ƒë√£ m·ªü kh√≥a trong phi√™n
    } catch (e) { /* sessionStorage c√≥ th·ªÉ kh√¥ng kh·∫£ d·ª•ng ·ªü ch·∫ø ƒë·ªô ri√™ng t∆∞ */ }

    const css = `
    .pc-overlay{position:fixed; inset:0; z-index:2147483647; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,.45); backdrop-filter:saturate(1.2) blur(12px)}
    .pc-wrap{width:min(380px,92vw); color:#fff; text-align:center; user-select:none}
    .pc-title{font-weight:600; font-size:20px; opacity:.95; margin-bottom:14px}
    .pc-dots{display:flex; justify-content:center; gap:14px; margin:6px 0 16px}
    .pc-dot{width:14px; height:14px; border-radius:50%; border:2px solid rgba(255,255,255,.6); background:transparent}
    .pc-dot.filled{background:#fff; border-color:#fff}
    .pc-msg{min-height:18px; font-size:13px; color:#ffb4b4; margin-bottom:8px; opacity:0; transition:opacity .2s ease}
    .pc-msg.show{opacity:1}
    .pc-keypad{display:grid; grid-template-columns:repeat(3,1fr); gap:12px; margin-top:10px}
    .pc-key{aspect-ratio:1/1; border-radius:999px; display:flex; align-items:center; justify-content:center; font-size:24px; line-height:1; background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12); cursor:pointer; -webkit-tap-highlight-color:transparent}
    .pc-key:active{background:rgba(255,255,255,.16)}
    .pc-sub{display:block; font-size:10px; opacity:.65; margin-top:2px}
    .pc-empty{pointer-events:none; opacity:0}
    .pc-ops{display:flex; justify-content:space-between; margin-top:14px}
    .pc-op{font-size:14px; opacity:.9; cursor:pointer; padding:6px 10px; border-radius:10px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.1)}
    .pc-op:active{background:rgba(255,255,255,.12)}
    @keyframes pc-shake{0%,100%{transform:translateX(0)}20%{transform:translateX(-10px)}40%{transform:translateX(8px)}60%{transform:translateX(-6px)}80%{transform:translateX(4px)}}
    .pc-wrap.error{animation:pc-shake .36s ease}
    .pc-fade{animation:pc-fade .24s ease forwards}
    @keyframes pc-fade{to{opacity:0; visibility:hidden}}
    `;

    const style = document.createElement('style');
    style.textContent = css; document.head.appendChild(style);

    const overlay = document.createElement('div');
    overlay.className = 'pc-overlay';
    overlay.setAttribute('role','dialog');
    overlay.setAttribute('aria-modal','true');
    overlay.setAttribute('aria-label','Nh·∫≠p m·∫≠t m√£ ƒë·ªÉ v√†o trang');

    overlay.innerHTML = `
      <div class="pc-wrap" id="pcWrap">
        <div class="pc-title">Nh·∫≠p m·∫≠t m√£</div>
        <div class="pc-dots" aria-label="Tr·∫°ng th√°i nh·∫≠p">
          <span class="pc-dot" id="d1"></span>
          <span class="pc-dot" id="d2"></span>
          <span class="pc-dot" id="d3"></span>
          <span class="pc-dot" id="d4"></span>
        </div>
        <div class="pc-msg" id="pcMsg">M·∫≠t m√£ kh√¥ng ƒë√∫ng</div>
        <div class="pc-keypad" id="pcPad">
          ${[1,2,3,4,5,6,7,8,9].map(n => `<button class="pc-key" data-key="${n}" aria-label="${n}">${n}</button>`).join('')}
          <div class="pc-key pc-empty" aria-hidden="true"></div>
          <button class="pc-key" data-key="0" aria-label="0">0</button>
          <button class="pc-key" data-action="del" aria-label="Xo√°">‚å´</button>
        </div>
        <div class="pc-ops">
          <button class="pc-op" data-action="clear" aria-label="Xo√° h·∫øt">Xo√° h·∫øt</button>
          <button class="pc-op" data-action="close" aria-label="·∫®n b√†n ph√≠m">·∫®n</button>
        </div>
      </div>`;

    // G·∫Øn v√†o DOM & kho√° cu·ªôn n·ªÅn
    document.body.appendChild(overlay);
    const prevOverflow = document.documentElement.style.overflow;
    document.documentElement.style.overflow = 'hidden';

    const wrap = overlay.querySelector('#pcWrap');
    const msg = overlay.querySelector('#pcMsg');
    const dots = [overlay.querySelector('#d1'), overlay.querySelector('#d2'), overlay.querySelector('#d3'), overlay.querySelector('#d4')];

    let input = '';
    const setDots = () => dots.forEach((d,i)=> d.classList.toggle('filled', i < input.length));
    const showError = () => { msg.classList.add('show'); wrap.classList.remove('error'); void wrap.offsetWidth; wrap.classList.add('error'); try{ navigator.vibrate && navigator.vibrate(160);}catch(_){} };
    const hideError = () => msg.classList.remove('show');

    function unlock(){
      try { sessionStorage.setItem(PASS_KEY, '1'); } catch (e) {}
      overlay.classList.add('pc-fade');
      setTimeout(()=>{ overlay.remove(); document.documentElement.style.overflow = prevOverflow || ''; }, 240);
    }

    function pressDigit(d){
      if (input.length >= 4) return;
      input += d;
      hideError();
      setDots();
      if (input.length === 4){
        setTimeout(() => {
          if (input === CORRECT) unlock();
          else { input = ''; setDots(); showError(); }
        }, 90);
      }
    }

    function backspace(){ if (!input) return; input = input.slice(0,-1); hideError(); setDots(); }
    function clearAll(){ input = ''; hideError(); setDots(); }

    overlay.addEventListener('click', (e) => {
      const t = e.target;
      if (t.matches('[data-key]')) { pressDigit(t.getAttribute('data-key')); }
      else if (t.matches('[data-action="del"]')) backspace();
      else if (t.matches('[data-action="clear"]')) clearAll();
      else if (t.matches('[data-action="close"]')) { /* ·∫©n b√†n ph√≠m nh∆∞ng KH√îNG cho v√†o trang */ overlay.blur(); }
    });

    // H·ªó tr·ª£ b√†n ph√≠m v·∫≠t l√Ω
    document.addEventListener('keydown', (e) => {
      if (!document.body.contains(overlay)) return;
      if (/^\d$/.test(e.key)) pressDigit(e.key);
      else if (e.key === 'Backspace') backspace();
      else if (e.key === 'Escape') clearAll();
    });

    // Focus trap th√¥ s∆°
    overlay.tabIndex = -1; overlay.focus();
  })();
  </script>
</body>
</html>
