<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Together â€“ Mobile Scroll Fix (Full Message)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --lavender: #C98AF7;
      --deep-purple: rgba(155, 75, 222, 0.3);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;width:100%}
    body{
      background:#111;
      font-family:"Poppins", sans-serif;
      min-height:100vh;
      overflow:auto;
      padding:max(16px, env(safe-area-inset-top)) max(16px, env(safe-area-inset-right)) max(16px, env(safe-area-inset-bottom)) max(16px, env(safe-area-inset-left));
    }
    .fit{
      position:relative; width:100%; max-width:1242px;
      /* Gáº¥p Ä‘Ã´i chiá»u cao, giá»¯ nguyÃªn chiá»u rá»™ng */
      aspect-ratio:1242/5376; /* 2688 x 2 */
      background:var(--lavender);
      overflow:auto; /* cuá»™n bÃªn trong .fit Ä‘á»ƒ á»•n Ä‘á»‹nh trÃªn mobile */
      border-radius:20px; margin:0 auto;
    }
    /* Ná»­a trÃªn: giá»¯ nguyÃªn layout cÅ© vá»›i Ä‘Ãºng tá»‰ lá»‡ 1242/2688 */
    .original{ position:relative; width:100%; aspect-ratio:1242/2688; background:transparent; overflow:hidden; z-index:2 }

    .phone{position:absolute; inset:0; background:var(--lavender); overflow:hidden}

    /* RAIN: dÃ¹ng absolute theo container Ä‘á»ƒ trÃ¡nh glitch khi cuá»™n mobile */
    .rain{ position:absolute; inset:0; width:100%; height:100%; pointer-events:none; z-index:2 }
    .drop{ position:absolute; top:-60px; user-select:none; will-change:transform, opacity }
    .drop.heart{ color:#9B4BDE }
    .drop.cat{ filter:saturate(1.1) }
    @keyframes fallFade{ 0%{transform:translateY(-60px) rotate(0deg); opacity:1} 70%{opacity:0.35} 100%{transform:translateY(calc(var(--fall-distance, 100vh) + 60px)) rotate(25deg); opacity:0} }

    .title{ position:absolute; left:6%; top:3%; color:#fff; font-weight:600; font-size:clamp(32px, 7vw, 90px); letter-spacing:1px; z-index:5 }
    @media (max-width:600px){ .title{ top:2% } }
    .main-card{ position:absolute; left:10%; right:10%; top:12%; height:35%; background:var(--deep-purple); border-radius:8vw; color:#fff; display:grid; place-items:center; z-index:3; padding:10px }
    .main-card .stack{ text-align:center; line-height:2.12 }
    .main-card .stack div{ font-size:clamp(20px, 6vw, 72px); font-weight:600 }
    .label{ font-size:clamp(12px, 3vw, 42px); font-weight:400; margin-left:1vw }
    .img-box{ position:absolute; left:12%; right:12%; bottom:6%; aspect-ratio:1/1; border-radius:3vw; overflow:hidden; background:#fff; box-shadow:0 2vw 5vw rgba(0,0,0,.25); z-index:4; display:flex; align-items:center; justify-content:center; transform:scale(0.75) }
    .img-stack{ position:relative; width:100%; height:100% }
    .img-stack img{ position:absolute; width:100%; height:100%; object-fit:cover; border-radius:2vw; transition:all .6s ease; image-rendering:-webkit-optimize-contrast; image-rendering:crisp-edges }
    #imgStack img{ opacity:.8 !important }
    .img-stack img:nth-child(1){ z-index:5; top:0; left:0 }
    .img-stack img:nth-child(2){ z-index:4; top:-1.2vw; left:-1.2vw }
    .img-stack img:nth-child(3){ z-index:3; top:-2.4vw; left:-2.4vw }
    .img-stack img:nth-child(4){ z-index:2; top:-3.6vw; left:-3.6vw }
    .img-stack img:nth-child(5){ z-index:1; top:-4.8vw; left:-4.8vw }
    .img-box.secondary{ left:50%; top:70%; transform:translateX(-50%) scale(1.35) }

    /* Ná»­a dÆ°á»›i: message á»Ÿ TRÃŠN mÆ°a */
    .extra{ position:relative; width:100%; padding:24px 20px 40px; display:flex; align-items:flex-start; justify-content:center; background:linear-gradient(180deg, rgba(0,0,0,.06), rgba(0,0,0,.12)); z-index:10 }
    .extra .rain{ z-index:9 }
    .message-box{ position:relative; z-index:11; width:min(92%, 1000px); background:rgba(201,138,247,.9); color:#fff; border-radius:16px; box-shadow:0 12px 28px rgba(0,0,0,.24); padding:16px 18px }
    .message-box h3{ font-size:18px; margin-bottom:8px; color:#fff }
    .message-box p{ font-size:14px; line-height:1.65; color:#fff }
  </style>
</head>
<body>
  <div class="fit" id="fit">
    <!-- Lá»›p mÆ°a cho ná»­a trÃªn -->
    <section class="original" id="original">
      <main class="phone">
        <div class="rain" id="rainTop"></div>
        <h1 class="title">TOGETHER</h1>
        <section class="main-card">
          <div class="stack">
            <div><span id="yearVal">0</span><span class="label">years</span></div>
            <div><span id="dayVal">0</span><span class="label">days</span></div>
            <div><span id="secondVal">0</span><span class="label">seconds</span></div>
          </div>
        </section>
        <div class="img-box">
          <div class="img-stack" id="imgStack"></div>
        </div>
        <div class="img-box secondary">
          <div class="img-stack" id="imgStackSecondary"></div>
        </div>
      </main>
    </section>

    <!-- Ná»­a dÆ°á»›i: lá»›p mÆ°a riÃªng + message-box á»Ÿ TRÃŠN -->
    <section class="extra" id="extra">
      <div class="rain" id="rainExtra"></div>
      <div class="message-box">
        <h3>Gá»­i em ğŸ’œ</h3>
        <p id="extraText">Cáº£ 1 quÃ¡ trÃ¬nh, 1 cháº·ng Ä‘Æ°á»ng, tá»« cÃ¡i lÃºc cÃ²n chÆ°a biáº¿t máº·t nhau, chá»‰ tÃ¬nh cá» Ä‘Ã¹a vá»›i nhau vÃ i cÃ¢u, rá»“i nháº¯n tin vá»›i nhau mÃ  rá»“i thÃ­ch nhau, yÃªu nhau, rá»“i cÃ£i vÃ£, rá»“i láº¡i thÆ°Æ¡ng, rá»“i khÃ´ng hiá»ƒu nhau, láº¡i cÃ£i nhau, rá»“i láº¡i hiá»ƒu nhau hÆ¡n, cÃ¹ng nhau tá»« nhá»¯ng ngÃ y Ä‘áº§u Ä‘áº·t chÃ¢n Ä‘áº¿n trÆ°á»ng, cÃ¹ng nhau tá»‘t nghiá»‡p, cÃ¹ng Ä‘i gáº§n Ä‘i xa, tráº£i qua khÃ´ng biáº¿t bao nhiÃªu chuyá»‡n lá»›n nhá», má»¥c Ä‘Ã­ch cuá»‘i cÃ¹ng váº«n lÃ  Ä‘á»ƒ á»Ÿ bÃªn nhau, nghÄ© vá» tÆ°Æ¡ng lai. Váº­y mÃ  chá»‰ vÃ¬ khoáº£ng thá»i gian nÃ y nguyÃªn nhÃ¢n chÃ­nh lÃ  khÃ´ng cÃ³ thá»i gian bÃªn nhau mÃ  láº¡i xa nhau, khÃ´ng lá»—i láº§m quÃ¡ Ä‘Ã¡ng khÃ´ng thá»ƒ tha thá»©, khÃ´ng cÃ³ nguyÃªn nhÃ¢n Ä‘á»§ náº·ng, khÃ´ng ngÆ°á»i thá»© 3, váº­y mÃ  láº¡i dá»… dÃ ng tá»« bá»!

<br><br>Anh biáº¿t mÃ¬nh Ä‘Ã£ qua cÃ¡i khoáº£ng thá»i gian mÃ  cáº§n nhau, nhá»› nhau nhiá»u tá»›i má»©c chá»‰ muá»‘n á»Ÿ cáº¡nh, má»—i giai Ä‘oáº¡n má»—i thá»i Ä‘iá»ƒm má»i thá»© cÅ©ng sáº½ thay Ä‘á»•i theo. BÃ¢y giá» cÅ©ng váº­y, khÃ´ng cáº§n pháº£i lÃºc nÃ o cÅ©ng pháº£i kÃ¨ bÃªn nhau, em cáº§n cÃ³ khÃ´ng gian riÃªng, anh cÅ©ng váº­y. NhÆ°ng chá»‰ cáº§n nhá»¯ng lÃºc nhÆ° cÃ³ viá»‡c Ä‘i xa thÃ¬ cÃ³ ngÆ°á»i Ä‘á»“ng hÃ nh, lÃºc cÃ³ lÃ m sao cÃ³ Ä‘i bá»‡nh viá»‡n thÃ¬ cÃ³ ngÆ°á»i Ä‘i cÃ¹ng, cÃ³ 1 ngÆ°á»i Ä‘á»ƒ trÃ² chuyá»‡n, Ä‘á»ƒ tÃ¢m sá»±. Anh nháº­n ra Ä‘Ã³ má»›i lÃ  cÃ¡i hiá»‡n táº¡i anh vÃ  em cáº§n, trÆ°á»›c giá» anh hong cÃ³ suy nghÄ© váº­y, hÃ´m nay anh má»›i ngáº«m láº¡i thÃ¬ anh cáº£m tháº¥y trÆ°á»›c giá» 2 Ä‘á»©a mÃ¬nh á»Ÿ bÃªn cáº¡nh nhau chá»‰ nghÄ© cáº§n nhau, cÃ³ tÃ¬nh cáº£m lÃ  Ä‘á»§, nhÆ°ng mÃ  thá»i Ä‘iá»ƒm nÃ y, thá»i gian bÃªn nhau khÃ´ng cÃ³, thÃ¬ anh nghÄ© quan tÃ¢m nhau má»›i lÃ  cÃ¡i quan trá»ng nháº¥t. KhÃ´ng pháº£i lÃ  trÆ°á»›c giá» anh khÃ´ng quan tÃ¢m em, chá»‰ lÃ  chÆ°a Ä‘á»§, anh khÃ´ng nÃ³i ra nhÆ°ng lÃºc nÃ o anh cÅ©ng nghÄ© em cáº§n gÃ¬, em thÃ­ch gÃ¬ Ä‘á»ƒ anh mua cho em vui, nhÆ°ng anh khÃ´ng nháº­n ra em cáº§n sá»± chia sáº», sá»± káº¿t ná»‘i hÆ¡n lÃ  Ä‘iá»u Ä‘Ã³. Em cÅ©ng quan tÃ¢m anh nhÆ°ng cÃ ng ngÃ y cÃ ng Ã­t Ä‘i vÃ¬ em khÃ´ng cÃ³ thá»i gian nghÄ© tá»›i ná»¯a, anh hiá»ƒu!! Hay lÃ  em cá»© cháº¥p nháº­n, cá»© Ä‘á»ƒ anh thay Ä‘á»•i cÃ¡ch mÃ¬nh quen nhau, thay Ä‘á»•i luÃ´n cáº£ cÃ¡ch nhÃ¬n nháº­n, Ä‘á»‘i xá»­ vá»›i nhau nháº¹ nhÃ ng hÆ¡n.

<br><br>Máº¥y hÃ´m nay anh suy nghÄ© nhiá»u láº¯m, vá» tá»«ng chuyá»‡n lá»›n nhá» xÆ°a giá», anh nghÄ© mÃ¬nh cÅ©ng Ä‘Ã£ thá»±c sá»± hiá»ƒu, cÅ©ng tá»›i lÃºc anh pháº£i trÆ°á»Ÿng thÃ nh rá»“i. NhÆ°ng anh váº«n muá»‘n cÃ³ em á»Ÿ cáº¡nh, váº«n muá»‘n em lÃ  Æ°u tiÃªn cá»§a anh, anh cÅ©ng khÃ´ng cáº§n em pháº£i thay Ä‘á»•i gÃ¬ Ä‘Ã¢u, chá»‰ lÃ  anh muá»‘n anh sáº½ thay Ä‘á»•i cÃ¡ch anh Ä‘á»‘i xá»­ vá»›i em thÃ´i. 7 nÄƒm qua em quen, em yÃªu 1 Ä‘á»©a con nÃ­t, bÃ¢y giá» anh biáº¿t Ä‘Ã£ Ä‘áº¿n lÃºc em cáº§n 1 ngÆ°á»i trÆ°á»Ÿng thÃ nh hÆ¡n.

<br><br>Thá»­ cÃ¹ng nhau cá»‘ gáº¯ng 1 láº§n, thay Ä‘á»•i cÃ¡ch suy nghÄ© 1 láº§n, cÃ¹ng hÆ°á»›ng tá»›i tÆ°Æ¡ng lai tá»‘t Ä‘áº¹p hÆ¡n. Bá» háº¿t nhá»¯ng chuyá»‡n khÃ´ng vui, lÃ m ngÆ°á»i yÃªu anh 1 láº§n ná»¯a, nha ğŸ’œ</p>
      </div>
    </section>
  </div>

  <!-- Káº¿t quáº£ test (áº©n) -->
  <details style="position:absolute; left:-9999px; top:-9999px;">
    <summary>Self tests</summary>
    <pre id="test-output"></pre>
  </details>

  <script>
  (() => {
    'use strict';

    // TrÃ¡nh khá»Ÿi táº¡o láº·p láº¡i náº¿u canvas tá»± reload
    if (window.__WE_HAVE_INIT__) {
      console.info('[WeHave] already initialized â€“ skip re-init');
      return;
    }
    window.__WE_HAVE_INIT__ = true;

    // --- Time counters ---
    const START = new Date(2018, 7, 13); // 13/08/2018
    const yearVal = document.getElementById('yearVal');
    const dayVal = document.getElementById('dayVal');
    const secondVal = document.getElementById('secondVal');

    const fullDaysSince = (s, n) => {
      const startD = new Date(s.getFullYear(), s.getMonth(), s.getDate());
      const nowD = new Date(n.getFullYear(), n.getMonth(), n.getDate());
      return Math.floor((nowD - startD) / 86400000);
    };
    const fullSecondsSince = (s, n) => Math.floor((n - s) / 1000);
    const fullYearsSince = (s, n) => {
      let y = n.getFullYear() - s.getFullYear();
      if (n.getMonth() < s.getMonth() || (n.getMonth() === s.getMonth() && n.getDate() < s.getDate())) y--;
      return y;
    };
    function updateCounters(){
      const now = new Date();
      yearVal.textContent = fullYearsSince(START, now);
      dayVal.textContent = fullDaysSince(START, now);
      secondVal.textContent = fullSecondsSince(START, now);
    }
    updateCounters();
    const counterTimer = setInterval(updateCounters, 1000);

    // --- Rain effect (mobile-safe) ---
    const fit = document.getElementById('fit');
    const original = document.getElementById('original');
    const extra = document.getElementById('extra');
    const rainTop = document.getElementById('rainTop');
    const rainExtra = document.getElementById('rainExtra');

    function setFallDistanceFor(el, container){
      if (!el || !container) return;
      const h = container.offsetHeight || fit.offsetHeight || window.innerHeight;
      el.style.setProperty('--fall-distance', h + 'px');
    }
    function setAllFallDistances(){
      setFallDistanceFor(rainTop, original);
      setFallDistanceFor(rainExtra, extra);
    }
    setAllFallDistances();
    window.addEventListener('resize', setAllFallDistances, { passive:true });

    let rafId = null;
    fit.addEventListener('scroll', () => {
      if (rafId) return;
      rafId = requestAnimationFrame(() => { setAllFallDistances(); rafId = null; });
    }, { passive:true });

    const rand = (min, max) => Math.random() * (max - min) + min;

    const MAX_DROPS_PER_LAYER = 160;
    function trimDrops(layer){
      if (!layer) return;
      while (layer.childElementCount > MAX_DROPS_PER_LAYER) layer.removeChild(layer.firstElementChild);
    }

    function spawnDrop(layer){
      if (!layer) return;
      const isCat = Math.random() < 0.35;
      const span = document.createElement('span');
      span.className = `drop ${isCat ? 'cat' : 'heart'}`;
      span.textContent = isCat ? 'ğŸ˜º' : 'ğŸ’œ';
      span.style.fontSize = (isCat ? rand(28, 44) : rand(18, 32)) + 'px';
      span.style.left = rand(0, 100) + '%';
      span.style.animation = `fallFade ${rand(5, 10)}s linear`;
      span.style.animationFillMode = 'forwards';
      layer.appendChild(span);
      span.addEventListener('animationend', () => span.remove(), { once:true });
      trimDrops(layer);
    }

    let rainTimer = null;
    function startRain(){
      if (rainTimer) return;
      rainTimer = setInterval(() => {
        const nTop = Math.floor(rand(1, 4));
        const nExtra = Math.floor(rand(1, 4));
        for (let i=0; i<nTop; i++) spawnDrop(rainTop);
        for (let i=0; i<nExtra; i++) spawnDrop(rainExtra);
      }, 300);
    }
    function stopRain(){ if (rainTimer) { clearInterval(rainTimer); rainTimer = null; } }

    document.addEventListener('visibilitychange', () => { if (document.hidden) stopRain(); else startRain(); });
    startRain();

    // --- Image stacks ---
    const LINKS = [
      'https://i.postimg.cc/kVHYddxK/Image-Aug-09-2025.png',
      'https://i.postimg.cc/FfYGpn2R/IMG-Aug-09-2025.jpg',
      'https://i.postimg.cc/PC32mkV9/IMG-Aug-09-2025-1.jpg',
      'https://i.postimg.cc/Vry9RsqG/IMG-20250809-214449.jpg',
      'https://i.postimg.cc/vxbWJPS5/IMG-20250809-214413.jpg'
    ];

    const stackEl = document.getElementById('imgStack');
    const stackElSecondary = document.getElementById('imgStackSecondary');
    const rotatedLinks = LINKS.slice(1).concat(LINKS[0]);

    rotatedLinks.forEach(src => {
      const img = document.createElement('img');
      img.src = src; img.referrerPolicy = 'no-referrer'; img.crossOrigin = 'anonymous';
      stackEl.appendChild(img.cloneNode());
    });

    LINKS.forEach(src => {
      const img = document.createElement('img');
      img.src = src; img.referrerPolicy = 'no-referrer'; img.crossOrigin = 'anonymous';
      stackElSecondary.appendChild(img);
    });

    const rotateTimer = setInterval(() => {
      const imgs = [...stackEl.children]; if (imgs.length) stackEl.appendChild(imgs.shift());
      const imgs2 = [...stackElSecondary.children]; if (imgs2.length) stackElSecondary.appendChild(imgs2.shift());
    }, 2000);

    // --- Self-tests ---
    (function runSelfTests(){
      const out = [];
      const log = (ok, name, got, exp) => {
        const icon = ok ? 'âœ…' : 'âŒ';
        const line = `${icon} ${name} | got: ${got} | expected: ${exp}`;
        (ok ? console.log : console.error)(line); out.push(line);
      };
      // A. Hai lá»›p mÆ°a tá»“n táº¡i
      log(!!rainTop, 'rainTop exists', !!rainTop, true);
      log(!!rainExtra, 'rainExtra exists', !!rainExtra, true);
      // B. fall-distance > 0
      const dTop = parseInt(getComputedStyle(rainTop).getPropertyValue('--fall-distance')) || 0;
      const dExtra = parseInt(getComputedStyle(rainExtra).getPropertyValue('--fall-distance')) || 0;
      log(dTop > 0, 'fall-distance top > 0', dTop, '>0');
      log(dExtra > 0, 'fall-distance extra > 0', dExtra, '>0');
      // C. Spawn thá»­ má»™t icon vÃ  auto-remove
      const before = rainTop.childElementCount;
      spawnDrop(rainTop);
      log(rainTop.childElementCount === before + 1, 'spawn one drop', rainTop.childElementCount, before + 1);
      const pre = document.getElementById('test-output'); if (pre) pre.textContent = out.join('\n');
      document.documentElement.setAttribute('data-tests', out.some(l => l.startsWith('âŒ')) ? 'failed' : 'passed');
    })();

    // Teardown (náº¿u cáº§n)
    window.__WE_HAVE_APP__ = { teardown(){ clearInterval(counterTimer); stopRain(); clearInterval(rotateTimer); window.removeEventListener('resize', setAllFallDistances); fit.removeEventListener('scroll', setAllFallDistances); } };
  })();
  </script>
</body>
</html>
